language: python
python:
- '2.7'
jobs:
  include:
  - stage: code-quality
    install:
    - pip install flake8
    script:
    - python -m flake8 --statistics --count --ignore E722,E501 bin/jinja-render.py
  - stage: test-installation
    script:
    - pip install .
    - inetsix-config-builder -h
  - stage: test-run
    script:
    - pip install git+https://github.com/titom73/inetsix-config-builder
    - inetsix-config-builder -t tests/template.j2 -y tests/data.yaml
    - cat generated-config.conf
  - stage: pypi-deploy
    name: Push package to pypi servers
    script:
    - echo "deploy to pypi.org"
    deploy:
      provider: pypi
      username: titom73
      skip_existing: true
      password:
        secure: "TWvF+gia7Bjy9R1hQFqV4p8MEHE8XnZHAQ9EnFMLk6HjB4YlKrVwr0n8fztoXGGeMm1yslXxyKUEjMtP0mbqEhp2Uu4+VQH3i70SKI5zxZZNu4VW+5UN8FODYcw838MfnL43oPLpA3KgODYvc/+r86GgMMvQKr6wWpuH4IxMVU3qfL84zBVO6trDDBCFeJraRhec4b3DejUgA7sqqSt5U+oYLoa3f4s2hgvCdRcqiPX3GME+MrKbbLq1fd2IzqnNMWKuzdkb4l2z+hc/O9d3gBSPiLyD2DmYRNxragvMZn1KZ06yshd5XQJsCbnD42OG5queUDA07wRSDNoFS7C2/qwYPp3IutjbWB/hf35/4UfCmpsAnXsGiu2n62RpcwX7heXrV1sS3gZLQGhSf5gNrc8vdwPHtfs8h4iJlexozvxcL5tQpMjMJuAIgRXJFDSeeR1SipT1HMRRhHX2jJHrvQH6wESBFzeLnvO37T6+pCkNwtp0FPqmpUhA6prUcXnu4JPumCwvbwSDqSXX3TZsodGsxqT5oPFKGoht08dYp2ca7k/UhYZWbF1Xm7bQoN4ANKYWtG94I8HqXb0evXZi6OouGLxtImot7KwJVZMhML1A77pDJG0Xob7owEaeBw9nrmB/YbA84uh30ONvdD2+q4p8JyQjQibM61JEUuiDtzM="
      on:
        tags: true
        distributions: sdist bdist_wheel
        repo: titom73/inetsix-config-builder